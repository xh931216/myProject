<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mzrd.dao.DesiredInfoDao">
	<!-- 封装账号 -->
	<resultMap type="com.mzrd.pojo.DesiredInfo" id="getMap">
		<id property="deid" column="deid" />
		<result property="srid" column="srid2" />
		<result property="id" column="id2" />
		<result property="state" column="stat" />
		<result property="overDate" column="overDate" />
		<result property="date" column="date"/>
		<result property="supplier" column="supplier" />
		<result property="remark" column="remark"/>
		<result property="desiredId" column="desiredId"/>
		<association property="supplyRankInfo" javaType="com.mzrd.pojo.SupplyRankInfo">
			<id property="srid" column="srid2" />
			<result property="srname" column="srname" />
		</association>
		<association property="staffAccountInfo" javaType="com.mzrd.pojo.StaffAccountInfo">
			<id property="id" column="id2" />
			<result property="userName" column="userName" />
			<result property="password" column="password" />
			<result property="rid" column="rid" />
			<result property="sname" column="sname" />
			<result property="phone" column="phone" />
			<result property="email" column="email" />
			<result property="state" column="sta" />
		</association>
		<association property="supplyAccountInfo" javaType="com.mzrd.pojo.SupplyAccountInfo">
			<id property="sid" column="sid"/>
			<result property="abbreviation" column="abbreviation"/>
		</association>
	</resultMap>	
	<select id="getDesiredInfoPdf" parameterType="com.mzrd.pojo.DesiredInfo" 
		resultMap="getMap">
		select di.srid srid2,di.*,si.*,di.id id2 from desired_info di,supply_rank_info si
			where di.srid = si.srid and di.deid=#{deid}
	</select>
	<select id="getDesiredInfo" parameterType="com.mzrd.pojo.DesiredInfo" 
		resultType="com.mzrd.pojo.DesiredInfo">
			select * from desired_info where id=#{id} and srid=#{srid} and supplier=#{supplier}
			and overDate = #{overDate} and remark=#{remark}
	</select>
	<select id="getSupllyDesiredList" parameterType="java.util.Map" resultMap="getMap">
		select *,sai.id id2,di.srid srid2 from desired_supply_info dsi,desired_info di,
		staff_account_info sai,supply_rank_info sri where
 		dsi.deid=di.deid  and di.state=1 and dsi.sid=1 and sai.id=di.id and sri.srid=di.srid
 		and di.overDate>NOW()
		<if test="srid!=null and srid!=''">
			and di.srid=#{srid}
		</if>
		<if test="overDate!=null and overDate!=''">
			and di.overDate like concat('%',#{overDate},'%')
		</if>
		ORDER BY di.deid DESC 
		<if test="start != null and limit != null">
		  limit #{start},#{limit}
		</if>
	</select>
	<select id="getStaffDesiredPage"  resultMap="getMap"
	 parameterType="java.util.Map">
		select sui.sid sid,sui.abbreviation abbreviation,di.*,sai.*,sri.*,
		sai.id id2,sai.state sta,di.state stat,di.srid srid2
 		from desired_info di,staff_account_info sai,supply_rank_info sri,post_info poi,supply_account_info sui,
		desired_supply_info desi
		where di.srid=sri.srid and sai.id=di.id and sai.state=1 and poi.rid=sai.rid and
		sui.sid=desi.sid and desi.deid=di.deid
		<if test="select==1">
			and sai.id=#{id}
		</if>
		<if test="select==2">
			and poi.did=#{did}
		</if>
		<if test="srid!=null and srid!=''">
			and di.srid=#{srid}
		</if>
		<if test="overDate!=null and overDate!=''">
			and di.overDate like concat('%',#{overDate},'%')
		</if>
		 <if test="state != null and state != ''">
		 and di.state=#{state}
		 </if>
		 ORDER BY di.deid DESC 
		<if test="start != null and limit != null">
		  limit #{start},#{limit}
		</if>
	</select>
	<select id="getPostInfo" parameterType="com.mzrd.pojo.DesiredInfo" 
		resultType="com.mzrd.pojo.PostInfo">
		select p.* from desired_info di,staff_account_info si,post_info p
 		where di.id=si.id and si.rid=p.rid and di.deid=#{deid}
	</select>
	
	<select id="getDesiredIdMax" resultType="java.lang.String"
		parameterType="java.lang.String">
		select Max(desiredId) from desired_info where desiredId like concat('%',#{date},'%')
	</select>
	<insert id="addDesiredInfo" parameterType="com.mzrd.pojo.DesiredInfo">
		insert into desired_info (srid,supplier,overDate,remark,desiredId,id,state,date) 
		values(#{srid},#{supplier},#{overDate},#{remark},#{desiredId},#{id},#{state},#{date});
	</insert>
	<update id="updateDesiredInfo" parameterType="com.mzrd.pojo.DesiredInfo">
		update desired_info 
		set srid=#{srid},id=#{id},overDate=#{overDate},supplier=#{supplier},
		remark=#{remark},state=#{state},date=#{date}
		where deid=#{deid}
	</update>
	
	<delete id="deleteDesiredInfo" parameterType="com.mzrd.pojo.DesiredInfo">
		delete from desired_info  where deid=#{deid}
	</delete>
</mapper>